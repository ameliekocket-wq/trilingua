<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trilingua</title>

<link rel="apple-touch-icon" href="logo.png">
<link rel="icon" href="logo.png">

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:#f2f7fb;
text-align:center;
}

header{
background:#cfe9f7;
padding:20px;
border-bottom-left-radius:25px;
border-bottom-right-radius:25px;
}

h1{margin:0;}

.stats{
margin-top:10px;
font-size:14px;
}

.container{padding:20px;}

.button{
padding:15px;
margin:8px;
border:none;
border-radius:15px;
background:#f8cfe0;
font-weight:bold;
cursor:pointer;
}

.level{background:#f8cfe0;}
.locked{background:#aaa;color:#555;cursor:not-allowed;}

.card{
background:white;
padding:20px;
margin:20px;
border-radius:20px;
}

input{
padding:8px;
border-radius:8px;
border:1px solid #ccc;
}
</style>
</head>

<body>

<header>
<h1>Trilingua</h1>
<div class="stats">
‚≠ê XP: <span id="xp">0</span> |
üî• Streak: <span id="streak">0</span>
</div>
</header>

<div id="menu" class="container"></div>
<div id="content"></div>

<script>

// ===== STATS =====

let XP = parseInt(localStorage.getItem("xp")) || 0;
let streak = parseInt(localStorage.getItem("streak")) || 0;
let lastPlayed = localStorage.getItem("lastPlayed");

document.getElementById("xp").innerText = XP;
document.getElementById("streak").innerText = streak;

updateStreak();

function updateStreak(){
let today = new Date().toDateString();

if(lastPlayed !== today){
let yesterday = new Date();
yesterday.setDate(yesterday.getDate()-1);

if(lastPlayed === yesterday.toDateString()){
streak++;
}else{
streak = 1;
}

localStorage.setItem("streak",streak);
localStorage.setItem("lastPlayed",today);
document.getElementById("streak").innerText = streak;
}
}

// ===== GAME STATE =====

let currentLanguage = null;
let currentLevel = null;
let questions = [];
let wrongQueue = [];
let index = 0;

// ===== DATA =====

const data = {

nor:[
["hei","takk","br√∏d","mor","vann"],
["venn","jobb","katt","hus","sol"],
["vind","regner","sn√∏r","h√∏st","vinter"],
["spr√•k","skole","l√¶rer","elev","klasse"],
["bord","stol","seng","rom","d√∏r"],
["hund","fisk","melk","ost","pizza"],
["venstre","h√∏yre","over","under","bak"],
["alltid","ofte","aldri","n√•","senere"],
["rik","fattig","lett","vanskelig","fort"],
["familie","bestevenn","s√∏ster","bror","far"]
],

spa:[
["rojo","azul","verde","negro","blanco"],
["camisa","zapatos","falda","abrigo","sombrero"],
["familia","hermano","madre","padre","abuela"],
["ayer","hoy","ma√±ana","siempre","nunca"],
["comida","agua","pan","leche","vino"],
["escuela","profesor","alumno","libro","mesa"],
["grande","peque√±o","r√°pido","lento","nuevo"],
["tener","ir","hacer","decir","venir"],
["viajar","comer","vivir","hablar","probar"],
["ciudad","casa","calle","mercado","tienda"]
],

eng:[
["dog","cat","house","water","friend"],
["blue","green","red","black","white"],
["teacher","student","school","book","table"],
["morning","evening","yesterday","today","tomorrow"],
["shirt","shoes","jacket","hat","dress"],
["always","never","often","sometimes","now"],
["big","small","fast","slow","easy"],
["family","mother","father","sister","brother"],
["travel","eat","drink","read","write"],
["city","street","market","shop","door"]
]

};

// ===== MENU =====

function renderMainMenu(){
document.getElementById("content").innerHTML="";
document.getElementById("menu").innerHTML=`
<button class="button" onclick="openLanguage('nor')">üá≥üá¥ Norwegisch</button>
<button class="button" onclick="openLanguage('spa')">üá™üá∏ Spanisch</button>
<button class="button" onclick="openLanguage('eng')">üá¨üáß Englisch</button>
`;
}

function openLanguage(lang){
currentLanguage=lang;
renderLevels();
}

function renderLevels(){

let unlocked = parseInt(localStorage.getItem(currentLanguage+"_unlocked")) || 1;

let html="<h2>Levels</h2>";

for(let i=1;i<=10;i++){
if(i<=unlocked){
html+=`<button class="button level" onclick="startLevel(${i})">Level ${i}</button>`;
}else{
html+=`<button class="button locked">üîí Level ${i}</button>`;
}
}

html+=`<br><button class="button" onclick="renderMainMenu()">Zur√ºck</button>`;
document.getElementById("menu").innerHTML=html;
}

// ===== START LEVEL =====

function startLevel(level){
currentLevel = level;
questions = [...data[currentLanguage][level-1]];
wrongQueue = [];
index = 0;
document.getElementById("menu").innerHTML="";
nextQuestion();
}

// ===== QUESTION FLOW =====

function nextQuestion(){

if(index >= questions.length){

if(wrongQueue.length > 0){
questions = [...wrongQueue];
wrongQueue = [];
index = 0;
return nextQuestion();
}

return finishLevel();
}

let word = questions[index];
index++;

document.getElementById("content").innerHTML=`
<div class="card">
<h3>Type this word again:</h3>
<h2>${word}</h2>
<input id="answer" autofocus>
<br><br>
<button onclick="checkAnswer('${word}')">Check</button>
</div>
`;
}

// ===== CHECK =====

function checkAnswer(word){

let input=document.getElementById("answer").value.trim().toLowerCase();

if(input === word.toLowerCase()){
XP += 10;
localStorage.setItem("xp",XP);
document.getElementById("xp").innerText = XP;
}else{
wrongQueue.push(word);
}

setTimeout(nextQuestion,300);
}

// ===== FINISH LEVEL =====

function finishLevel(){

let unlocked = parseInt(localStorage.getItem(currentLanguage+"_unlocked")) || 1;

if(currentLevel === unlocked && unlocked < 10){
unlocked++;
localStorage.setItem(currentLanguage+"_unlocked", unlocked);
}

let nextButton = "";

if(currentLevel < 10){
nextButton = `<button onclick="startLevel(${currentLevel+1})">‚û° Weiter zu Level ${currentLevel+1}</button>`;
}

document.getElementById("content").innerHTML=`
<div class="card">
<h2>üéâ Level ${currentLevel} geschafft!</h2>
${nextButton}
<br><br>
<button onclick="renderLevels()">Zur√ºck zu Levels</button>
</div>
`;
}

renderMainMenu();

</script>
</body>
</html>
